<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <title>Nivi Jha | Portfolio</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="/css/style.css" />

  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>

  <!-- Vercel Speed Insights -->
  <script>
    window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    
    // Optional: Add a beforeSend function to filter sensitive data
    // See: https://vercel.com/docs/speed-insights/package#beforesend
    window.speedInsightsBeforeSend = function(data) {
      // Clean up sensitive parameters from the URL if needed
      if (data.url) {
        data.url = data.url.split('?')[0]; // Remove query parameters
      }
      return data;
    };
  </script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
</head>


<body>
  <div class="bg-orb one"></div>
  <div class="bg-orb two"></div>

  <div class="cursor-code"><strong>‚Åñ</strong></div>
  <div class="cursor-orb" id="cursor-orb"></div>

  <script>
    const codeCursor = document.querySelector(".cursor-code");

    let mouseX = 0, mouseY = 0;

    document.addEventListener("mousemove", (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;

      codeCursor.style.left = mouseX + "px";
      codeCursor.style.top = mouseY + "px";
      codeCursor.style.opacity = "1";

    });

    function animate() {
      orbX += (mouseX) * 0.15;
      orbY += (mouseY) * 0.15;

      orb.style.left = orbX + "px";
      orb.style.top = orbY + "px";

      requestAnimationFrame(animate);
    }

    animate();
  </script>

  <%- include('../includes/navbar') %>
    <main>
      <%- body %>
        <div id="scroll-progress"></div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("year").textContent =
          new Date().getFullYear();
      });
    </script>

    <%- include('../includes/footer') %>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

      <!-- Fade-in animation -->
      <script>
        const reveals = document.querySelectorAll(".reveal, .reveal-stagger");

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("show");
              }
            });
          },
          { threshold: 0.15 }
        );

        reveals.forEach((el) => observer.observe(el));
      </script>

      <!-- SCROLL PROGRESS BAR -->
      <script>
        const progressBar = document.getElementById("scroll-progress");

        window.addEventListener("scroll", () => {
          const scrollTop = window.scrollY;
          const docHeight =
            document.documentElement.scrollHeight -
            document.documentElement.clientHeight;

          const scrollPercent = (scrollTop / docHeight) * 100;
          progressBar.style.width = scrollPercent + "%";
        });
      </script>

      <!-- SUBTITLE TYPING EFFECT -->
      <script>
        const words = [
          "Full Stack Developer",
          "Competitive Programmer",
          "Developer who ships.",
        ];

        let i = 0,
          j = 0,
          isDeleting = false;
        const typingSpeed = 90;
        const deletingSpeed = 50;
        const pause = 1200;

        const el = document.getElementById("typing-text");

        function type() {
          const current = words[i];
          if (!isDeleting) {
            el.textContent = current.slice(0, j++);
            if (j === current.length) {
              setTimeout(() => (isDeleting = true), pause);
            }
          } else {
            el.textContent = current.slice(0, j--);
            if (j === 0) {
              isDeleting = false;
              i = (i + 1) % words.length;
            }
          }
          setTimeout(type, isDeleting ? deletingSpeed : typingSpeed);
        }

        type();
      </script>

      <!-- Intent Text -->
      <script>
        const intentItems = document.querySelectorAll(".intent-text");

        intentItems.forEach(el => {
          el.addEventListener("mouseenter", () => {
            intentItems.forEach(other => {
              if (other !== el) other.classList.add("intent-dim");
            });
            el.classList.add("intent-focus");
          });

          el.addEventListener("mouseleave", () => {
            intentItems.forEach(other =>
              other.classList.remove("intent-dim", "intent-focus")
            );
          });
        });
      </script>

      <!-- Magnetic Button -->
      <script>
        document.querySelectorAll(".magnetic").forEach(el => {
          el.addEventListener("mousemove", (e) => {
            const r = el.getBoundingClientRect();
            const x = e.clientX - r.left - r.width / 2;
            const y = e.clientY - r.top - r.height / 2;
            el.style.transform = `translate(${x * 0.25}px, ${y * 0.25}px)`;
          });

          el.addEventListener("mouseleave", () => {
            el.style.transform = "translate(0,0)";
          });
        });
      </script>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const navbar = document.querySelector(".navbar.glass-nav");

          window.addEventListener("scroll", () => {
            if (window.scrollY > 40) {
              navbar.classList.add("scrolled");
            } else {
              navbar.classList.remove("scrolled");
            }
          });
        });
      </script>

      <script>
        const navLinks = document.querySelectorAll(".nav-link");
        const sections = document.querySelectorAll("section");

        function updateActiveNav() {
          const viewportCenter = window.innerHeight / 2;
          let currentSection = null;

          sections.forEach(section => {
            const rect = section.getBoundingClientRect();

            if (rect.top <= viewportCenter && rect.bottom >= viewportCenter) {
              currentSection = section.id;
            }
          });

          if (!currentSection) return;

          navLinks.forEach(link => {
            const href = link.getAttribute("href")?.replace("#", "");
            link.classList.toggle("active", href === currentSection);
          });
        }

        window.addEventListener("scroll", updateActiveNav);
        window.addEventListener("load", updateActiveNav);
      </script>

      <!-- DARK & LIGHT MODE TOGGLE -->
      <script>
        const toggleBtn = document.getElementById("theme-toggle");
        const icon = toggleBtn.querySelector("i");

        // Load saved theme
        if (localStorage.getItem("theme") === "light") {
          document.body.classList.add("light");
          icon.classList.replace("fa-moon", "fa-sun");
        }

        toggleBtn.addEventListener("click", () => {
          document.body.classList.toggle("light");

          const isLight = document.body.classList.contains("light");
          localStorage.setItem("theme", isLight ? "light" : "dark");

          icon.classList.toggle("fa-moon");
          icon.classList.toggle("fa-sun");
        });
      </script>

      <script>
  document.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("hero-name");
    if (!el) return;

    const finalText = el.textContent;
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789{}/|*&^%$#@~+_></][}{;':`?";
    let iterations = 0;

    // clear text before animation
    el.textContent = "";

    const interval = setInterval(() => {
      el.textContent = finalText
        .split("")
        .map((char, index) => {
          if (char === " ") return " ";

          if (index < iterations) {
            return finalText[index];
          }

          return chars[Math.floor(Math.random() * chars.length)];
        })
        .join("");

      iterations += 1 / 5;

      if (iterations >= finalText.length) {
        el.textContent = finalText;
        clearInterval(interval);
      }
    }, 50);
  });
</script>


      <!-- Contact form handler -->
      <script src="/js/contactHandler.js"></script>
</body>

</html>